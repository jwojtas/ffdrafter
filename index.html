<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fantasy Draft Simulator</title>
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
<div id="root"></div>

<script type="text/babel">
const defaultTeams = ["Team 1","Team 2","Team 3","Team 4","Team 5","Team 6","Team 7","Team 8"];
const startersRequired = { QB:1,RB:2,WR:2,TE:1,FLEX:1,DST:1,K:1 };
const maxPlayers = { QB:4,RB:8,WR:8,TE:3,FLEX:1,DST:3,K:3,BE:7 };

function generateSnakeOrder(numTeams, totalRounds, userPickIndex) {
  let order = [];
  for (let round = 0; round < totalRounds; round++) {
    let roundOrder = Array.from({ length: numTeams }, (_, i) => i);
    if (round % 2 !== 0) roundOrder.reverse();
    order.push(...roundOrder);
  }
  if (userPickIndex > 0) {
    const firstRound = order.slice(0, numTeams);
    const shifted = [];
    for (let i = 0; i < numTeams; i++) {
      shifted.push(firstRound[(i + userPickIndex) % numTeams]);
    }
    order.splice(0, numTeams, ...shifted);
  }
  return order;
}

function App() {
  const [players, setPlayers] = React.useState([]);
  const [teams, setTeams] = React.useState([]);
  const [draftOrder, setDraftOrder] = React.useState([]);
  const [currentPickIndex, setCurrentPickIndex] = React.useState(0);
  const [numTeams, setNumTeams] = React.useState(8);
  const [draftStarted, setDraftStarted] = React.useState(false);
  const [loading, setLoading] = React.useState(false);
  const [error, setError] = React.useState("");
  const [userPickPosition, setUserPickPosition] = React.useState(0);
  const [manualOtherTeams, setManualOtherTeams] = React.useState(false);
  const [teamNames, setTeamNames] = React.useState(defaultTeams.slice(0,8));
  const [searchTerm, setSearchTerm] = React.useState("");

  const fetchADP = async () => {
    setLoading(true);
    setError("");
    try {
      const data = { players: [] };
      for(let i=1;i<=200;i++){
        const posArray = ["QB","RB","WR","TE","DST","K"];
        const pos = posArray[Math.floor(Math.random()*posArray.length)];
        data.players.push({
          name: `Player ${i}`,
          pos,
          adp: i,
          drafted: false
        });
      }
      setPlayers(data.players);
    } catch(e) {
      console.error(e);
      setError("Could not fetch ADP data.");
    }
    setLoading(false);
  };

  const startDraft = () => {
    let draftTeams = [];
    for (let i = 0; i < numTeams; i++) {
      draftTeams.push({
        name: teamNames[i] || `Team ${i+1}`,
        roster: {QB:[],RB:[],WR:[],TE:[],FLEX:[],DST:[],K:[],BE:[]}
      });
    }
    setTeams(draftTeams);
    const order = generateSnakeOrder(numTeams, 15, userPickPosition);
    setDraftOrder(order);
    setCurrentPickIndex(0);
    setDraftStarted(true);
  };

  const suggestPick = (team) => {
    const teamNeeds = {};
    for(let pos of ["QB","RB","WR","TE","FLEX","DST","K"]) {
      teamNeeds[pos] = Math.max(0, startersRequired[pos]-team.roster[pos].length);
    }
    const available = players.filter(p => !p.drafted);
    let needed = [];
    for(let pos of ["QB","RB","WR","TE","FLEX","DST","K"]){
      if(teamNeeds[pos]>0){
        if(pos==="FLEX") needed.push(...available.filter(p=>["RB","WR","TE"].includes(p.pos)));
        else needed.push(...available.filter(p=>p.pos===pos));
      }
    }
    let sorted = (needed.length?needed:available).sort((a,b)=>a.adp-b.adp);
    return sorted[0];
  };

  const assignPlayerToTeam = (teamIndex, player) => {
    const team = teams[teamIndex];
    if(team.roster[player.pos].length < startersRequired[player.pos]){
      team.roster[player.pos].push(player);
    } else if((player.pos==="RB"||player.pos==="WR"||player.pos==="TE") && team.roster.FLEX.length<startersRequired.FLEX){
      team.roster.FLEX.push(player);
    } else if(team.roster[player.pos].length<maxPlayers[player.pos]){
      team.roster[player.pos].push(player);
    } else {
      team.roster.BE.push(player);
    }
    player.drafted = true;
    const newTeams = [...teams];
    newTeams[teamIndex]=team;
    setTeams(newTeams);
  };

  const draftPlayer = (player) => {
    const pickTeamIndex = draftOrder[currentPickIndex];
    assignPlayerToTeam(pickTeamIndex, player);
    setCurrentPickIndex(currentPickIndex+1);
  };

  const draftNext = () => {
    if(currentPickIndex>=draftOrder.length) return;
    const pickTeamIndex = draftOrder[currentPickIndex];
    const isUser = pickTeamIndex===userPickPosition;
    if(!isUser && !manualOtherTeams){
      const player = suggestPick(teams[pickTeamIndex]);
      draftPlayer(player);
    }
  };

  React.useEffect(()=>{
    if(draftStarted && currentPickIndex<draftOrder.length){
      draftNext();
    }
  },[currentPickIndex,draftStarted]);

  const draftComplete = currentPickIndex>=draftOrder.length;
  const currentTeam = draftOrder[currentPickIndex]!=null?teams[draftOrder[currentPickIndex]]:null;
  const suggestedPickPlayer = currentTeam?suggestPick(currentTeam):null;

  const gradeTeam = (team) => {
    if(!team||!team.roster) return 0;
    const totalADP = Object.values(team.roster).flat().reduce((sum,p)=>sum+p.adp,0);
    const posScore = Object.entries(team.roster).reduce((sum,[pos,arr])=>{
      let req = startersRequired[pos]||0;
      return sum+Math.min(arr.length/req,1);
    },0);
    return ((posScore/6)*50 + ((teams.length*15-totalADP)/(teams.length*15))*50).toFixed(1);
  };

  return (
    <div className="max-w-6xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-4">Fantasy Draft Simulator</h1>

      {!draftStarted && (
        <div className="mb-6 space-y-4">
          <div>
            <label className="mr-2"># of Teams:</label>
            <select value={numTeams} onChange={e=>setNumTeams(Number(e.target.value))} className="border rounded px-2 py-1">
              <option value={8}>8</option>
              <option value={10}>10</option>
              <option value={12}>12</option>
            </select>
          </div>
          <div>
            <label className="mr-2">Your Draft Position:</label>
            <select value={userPickPosition} onChange={e=>setUserPickPosition(Number(e.target.value))} className="border rounded px-2 py-1">
              {Array.from({length:numTeams},(_,i)=><option key={i} value={i}>{i+1}</option>)}
            </select>
          </div>
          <div>
            <label className="mr-2">Pick Mode for Other Teams:</label>
            <select value={manualOtherTeams} onChange={e=>setManualOtherTeams(e.target.value==="true")} className="border rounded px-2 py-1">
              <option value={false}>Auto Pick</option>
              <option value={true}>Manual Pick</option>
            </select>
          </div>
          <div>
            <button onClick={fetchADP} className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mr-2">Load Players</button>
            <button onClick={startDraft} className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Start Draft</button>
            {loading && <span className="ml-2">Loading...</span>}
            {error && <p className="text-red-500 mt-2">{error}</p>}
          </div>
        </div>
      )}

      {draftStarted && !draftComplete && currentTeam && (
        <div className="mb-6 space-y-4">
          <h2 className="text-xl font-bold">Current Pick: {currentTeam.name}</h2>
          <p>Suggested Pick: {suggestedPickPlayer ? `${suggestedPickPlayer.name} (${suggestedPickPlayer.pos}) | ADP: ${suggestedPickPlayer.adp}` : "No pick available"}</p>
          <button onClick={()=>draftPlayer(suggestedPickPlayer)} className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 mb-2">Draft Suggested Pick</button>

          <input
            type="text"
            placeholder="Search player..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="border rounded px-2 py-1 w-full mb-2"
          />
          <select
            onChange={(e) => {
              const player = players.find(p => p.name===e.target.value);
              if(player) draftPlayer(player);
              setSearchTerm("");
            }}
            className="border rounded p-1 w-full"
          >
            <option value="">--Select Player--</option>
            {players.filter(p=>!p.drafted && p.name.toLowerCase().includes(searchTerm.toLowerCase())).map((p,i)=>(
              <option key={i} value={p.name}>{p.name} ({p.pos}) | ADP: {p.adp}</option>
            ))}
          </select>
        </div>
      )}

      {draftStarted && (
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
          {teams.map((team,i)=>(
            <div key={i} className={`bg-white p-4 rounded-xl shadow ${i===userPickPosition?'border-2 border-blue-500':''}`}>
              <h3 className="font-bold mb-2">{team.name}</h3>
              {["QB","RB","WR","TE","FLEX","DST","K","BE"].map(pos=>{
                const arr = team.roster[pos]||[];
                let color = "";
                if(pos==="FLEX") color="text-green-600 font-semibold";
                else if(pos==="BE") color="text-gray-500 italic";
                return (
                  <div key={pos} className={`${color} mb-1`}>
                    <strong>{pos}:</strong> {arr.map(p=>`${p.name} (ADP: ${p.adp})`).join(", ")}
                  </div>
                )
              })}
              {draftComplete && <p className="mt-2 font-bold">Grade: {gradeTeam(team)}</p>}
            </div>
          ))}
        </div>
      )}

      {draftComplete && (
        <div className="bg-green-100 p-4 rounded-xl">
          <h2 className="text-xl font-bold mb-2">Draft Complete!</h2>
          <p>Your Team is ready!</p>
        </div>
      )}

    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById("root"));
</script>
</body>
</html>
