<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mock Draft</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .player { padding: 5px; border-bottom: 1px solid #ddd; }
    .controls { margin-bottom: 20px; }
    select, input { margin: 5px 0; padding: 5px; width: 250px; }
    button { margin-left: 10px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    function App() {
      const [players, setPlayers] = React.useState([]);
      const [teams, setTeams] = React.useState(12);
      const [currentPick, setCurrentPick] = React.useState(1);
      const [draft, setDraft] = React.useState({});
      const [manualOtherTeams, setManualOtherTeams] = React.useState(false);
      const [search, setSearch] = React.useState("");
      const [selectedPlayer, setSelectedPlayer] = React.useState("");

      // Fetch players from Netlify function
      React.useEffect(() => {
        fetch("/.netlify/functions/adp")
          .then(res => res.json())
          .then(data => setPlayers(data.players || []))
          .catch(err => console.error("Failed to fetch players:", err));
      }, []);

      const availablePlayers = players.filter(p => !draft[p.name]);

      const suggestedPick = availablePlayers[0]; // ADP-based best available

      function makePick(player, team) {
        if (!player) return;
        setDraft(prev => ({ ...prev, [player.name]: { ...player, team } }));
        setCurrentPick(prev => prev + 1);
        setSearch("");
        setSelectedPlayer("");
      }

      function handleAutoOrManualPick() {
        const team = ((currentPick - 1) % teams) + 1;

        if (team !== 1 && !manualOtherTeams) {
          // Auto pick for other teams
          makePick(suggestedPick, team);
        } else {
          // For user team (or manual mode for other teams)
          if (selectedPlayer) {
            const player = availablePlayers.find(p => p.name === selectedPlayer);
            makePick(player, team);
          } else {
            makePick(suggestedPick, team);
          }
        }
      }

      const filtered = availablePlayers.filter(p =>
        p.name.toLowerCase().includes(search.toLowerCase()) ||
        p.pos?.toLowerCase().includes(search.toLowerCase())
      );

      return (
        <div>
          <div className="controls">
            <h2>Setup</h2>
            <label>
              Number of Teams:{" "}
              <input
                type="number"
                value={teams}
                onChange={e => setTeams(Number(e.target.value))}
                min="2"
                max="32"
              />
            </label>
            <br/>
            <label>
              <input
                type="checkbox"
                checked={manualOtherTeams}
                onChange={e => setManualOtherTeams(e.target.checked)}
              />
              Manually pick for other teams
            </label>
          </div>

          <h3>Pick #{currentPick} — Team {(currentPick - 1) % teams + 1}</h3>
          <p>Suggested Pick: {suggestedPick ? `${suggestedPick.name} (${suggestedPick.pos}, ADP ${suggestedPick.adp})` : "N/A"}</p>

          <div>
            <input
              type="text"
              placeholder="Search players..."
              value={search}
              onChange={e => setSearch(e.target.value)}
            />
            <select
              value={selectedPlayer}
              onChange={e => setSelectedPlayer(e.target.value)}
            >
              <option value="">-- Select Player --</option>
              {filtered.map(p => (
                <option key={p.name} value={p.name}>
                  {p.name} ({p.pos}) | ADP: {p.adp}
                </option>
              ))}
            </select>
            <button onClick={handleAutoOrManualPick}>Draft</button>
          </div>

          <h3>Draft Results</h3>
          {Object.values(draft).map((pick, i) => (
            <div key={i} className="player">
              Pick {i+1}: Team {pick.team} — {pick.name} ({pick.pos}) | ADP {pick.adp}
            </div>
          ))}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
